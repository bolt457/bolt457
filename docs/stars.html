<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stars - AfricoinMarket</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Styles pour les cartes de stars */
        .star-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            width: 250px;
        }
        .platform-links {
            margin-top: 20px;
            text-align: center;
        }
        .platform-links a {
            margin: 0 10px;
            text-decoration: none;
            color: #007bff;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Accueil</a></li>
                <li><a href="stars.html">Stars</a></li>
                <li><a href="statistics.html">Statistiques</a></li>
                <li><a href="shop.html">Acheter AFRICOINS</a></li>
                <li><a href="account.html">Mon Compte</a></li>
                <li><a href="ads.html">Publicités</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h2>Investissez dans les Stars</h2>
        <div id="root"></div>
        <table id="stars-table"></table>
        
        <!-- Formulaire pour ajouter une star -->
        <form id="add-star-form">
            <select id="category" required>
                <option value="actor">Acteur</option>
                <option value="athlete">Athlète</option>
                <option value="musician">Musicien</option>
            </select>
            <input type="text" id="star-name" placeholder="Nom de la star" required />
            <button type="submit">Ajouter Star</button>
        </form>

        <!-- Liens vers les plateformes -->
        <div class="platform-links">
            <h3>Liens vers les plateformes</h3>
            <a href="https://www.themoviedb.org/" target="_blank">TMDb</a>
            <a href="https://www.football-data.org/" target="_blank">Football-Data</a>
            <a href="https://open.spotify.com/" target="_blank">Spotify</a>
            <a href="https://www.youtube.com/" target="_blank">YouTube</a>
            <a href="https://www.tiktok.com/" target="_blank">TikTok</a>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 AfricoinMarket</p>
    </footer>

    <script src="js/StarsComponent.js" type="module"></script>
    <script src="js/frontend.js" type="module"></script>
    <script src="js/star.js" type="module"></script>

    <script>
        // Clés d'autorisation
        const spotifyToken = 'BQCN3Cs42747KOZI_-D3uINuxsk91KeatLUiKLqVC-T6irObkP_t6Gto7QfJrB2txrh9lWotstsIb9nuNH0xA6rVj-VM_kbYt5k_PifldoX3YhM5MklbM370ZgmxOHb-DXe6_7GcmoganuFHjAAU9VfH2NfUkZYXmwwZius9Cv69Lbv4MXBjNml0XQzNQGdyEfYSF5hjYW3zjuIaNSNQYTv8YzDTivc28Un0HmNGFdk8GebVHpQS9fp7OJfx_AcFBwQ9wC6pHwurj2JsUFVjWfkMLAVDFcaK';
        const footballToken = '8bd2be175a294d5a95759019187c6ef3'; // Token pour football-data.org
        const tmdbApiKey = '01c9aa6b29f59a2a302d4ae8a4d0de78'; // Clé API pour TMDb
        const youtubeApiKey = 'AIzaSyAiNL-4YPv6TTgB0lVi4_Xbr4Y9kX1_C2I'; // Clé API pour YouTube

        let stars = [];
        let investments = [];

        async function fetchActorByName(name) {
            const apiKey = tmdbApiKey;
            const url = `https://api.themoviedb.org/3/search/person?api_key=${apiKey}&query=${encodeURIComponent(name)}&language=fr-FR`;

            const response = await fetch(url);
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`Erreur lors de la récupération des données de l'acteur : ${errorData.status_message}`);
            }
            return response.json();
        }

        async function fetchMusicianByName(name) {
            const url = `https://api.spotify.com/v1/search?q=${encodeURIComponent(name)}&type=artist`;
            const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${spotifyToken}` }
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`Erreur lors de la récupération des données du musicien : ${errorData.error.message}`);
            }
            return response.json();
        }

        async function fetchYouTubeVideos(query) {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&key=${youtubeApiKey}&maxResults=5`;
            const response = await fetch(url);
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`Erreur lors de la récupération des vidéos YouTube : ${errorData.error.message}`);
            }
            return response.json();
        }

        function simulateRatingChange() {
            stars.forEach(star => {
                star.rating += Math.floor(Math.random() * 3) - 1; // Variation aléatoire de -1 à 1
                if (star.rating < 0) star.rating = 0; // Assurez-vous que la cote ne soit pas négative
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const starsTable = document.getElementById('stars-table');

            function displayStars() {
                starsTable.innerHTML = ''; 
                stars.forEach(star => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${star.name}</td>
                        <td><img src="${star.image}" alt="${star.name}" width="100"></td>
                        <td>${star.rating}</td>
                        <td>
                            <input type="number" placeholder="Africoins" min="1" id="investment-${star.name}" />
                            <select id="duration-${star.name}">
                                <option value="1 semaine">1 Semaine</option>
                                <option value="1 mois">1 Mois</option>
                                <option value="3 mois">3 Mois</option>
                                <option value="6 mois">6 Mois</option>
                            </select>
                            <button onclick="investInStar('${star.name}')">Investir</button>
                        </td>
                    `;
                    starsTable.appendChild(row);
                });
            }

            document.getElementById('add-star-form').addEventListener('submit', async function(event) {
                event.preventDefault();
                
                const category = document.getElementById('category').value;
                const starName = document.getElementById('star-name').value;

                try {
                    let data;
                    let name, imageUrl, rating;

                    if (category === 'actor') {
                        data = await fetchActorByName(starName);
                        if (data.results.length > 0) {
                            name = data.results[0].name;
                            imageUrl = data.results[0].profile_path ? `https://image.tmdb.org/t/p/w500${data.results[0].profile_path}` : "URL par défaut";
                            rating = Math.floor(Math.random() * 10); // Cote initiale aléatoire
                        } else {
                            throw new Error("Aucun acteur trouvé avec ce nom.");
                        }
                    } else if (category === 'musician') {
                        data = await fetchMusicianByName(starName);
                        if (data.artists.items.length > 0) {
                            name = data.artists.items[0].name;
                            imageUrl = data.artists.items[0].images[0]?.url || "URL par défaut";
                            rating = Math.floor(Math.random() * 10); // Cote initiale aléatoire
                        } else {
                            throw new Error("Aucun musicien trouvé avec ce nom.");
                        }
                    }

                    // Fetch YouTube videos related to the star
                    const youtubeData = await fetchYouTubeVideos(name);
                    console.log(youtubeData); // Afficher les vidéos dans la console

                    stars.push({ name, image: imageUrl, rating });
                    displayStars();

                    event.target.reset();
                } catch (error) {
                    alert(error.message);
                }
            });

            displayStars();
        });

        function investInStar(starName) {
            const investmentInput = document.getElementById(`investment-${starName}`);
            const durationSelect = document.getElementById(`duration-${starName}`);
            const investmentAmount = investmentInput.value;
            const investmentDuration = durationSelect.value;

            if (investmentAmount && investmentAmount > 0) {
                const star = stars.find(s => s.name === starName);
                investments.push({
                    star: starName,
                    amount: investmentAmount,
                    duration: investmentDuration,
                    initialRating: star.rating
                });
                alert(`Vous avez investi ${investmentAmount} Africoins dans ${starName} pour une durée de ${investmentDuration}.`);

                setTimeout(() => {
                    simulateRatingChange();
                    const updatedStar = stars.find(s => s.name === starName);
                    const gains = (updatedStar.rating / star.rating) * investmentAmount - investmentAmount;

                    if (gains > 0) {
                        alert(`Gains réalisés : ${gains.toFixed(2)} Africoins.`);
                    } else {
                        alert(`Vous avez perdu : ${Math.abs(gains).toFixed(2)} Africoins.`);
                    }
                }, 5000); // Changer cela pour simuler un délai réel
            } else {
                alert("Veuillez entrer un montant valide d'Africoins.");
            }
        }
    </script>
</body>
</html>